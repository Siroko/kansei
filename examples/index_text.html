<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Example WebGPU Renderer</title>
    <style>
      body {
        margin: 0;
        padding: 0;
        overflow: hidden;
        background-color: black;
      }
    </style>
  </head>
  <body>
    <script type="module">
      import { FontLoader } from '../src/sdf/text/FontLoader'
      import { Renderer } from '../src/renderers/Renderer'
      import { Material } from '../src/materials/Material'
      import { PlaneGeometry } from '../src/geometries/PlaneGeometry'
      import { Mesh } from '../src/objects/Mesh'
      import { Scene } from '../src/objects/Scene'
      import { Camera } from '../src/cameras/Camera'
      import { CameraControls } from '../src/controls/CameraControls'
      import { shaderCode } from './assets/shaders/TextShader.js'
      import { Sampler } from '../src/buffers/Sampler'
      import { Vector4 } from '../src/math/Vector4'
      import { TextGeometry } from '../src/geometries/TextGeometry'

      const renderer = new Renderer({
        alphaMode: "premultiplied",
        clearColor: new Vector4(0, 0, 0, 0),  // Fully transparent black
        width: window.innerWidth,
        height: window.innerHeight
      });
      await renderer.initialize();
      document.body.appendChild(renderer.domElement);

      const scene = new Scene();
      const camera = new Camera(20, 0.1, 100000, window.innerWidth / window.innerHeight);
      const cameraControls = new CameraControls(camera, scene.position);

      const fontLoader = new FontLoader();
      const fontInfo = await fontLoader.load('assets/fonts/TT_Supermolot_Neue_Extended_ExtraLight.arfont');
      const geometry = new TextGeometry('HELL`O KANSEI HELL`O KANSEI HELL`O KANSEI HELL`O KANSEI HELL`O KANSEI HELL`O KANSEI HELL`O KANSEI HELL`O KANSEI HELL`O KANSEI HELL`O KANSEI HELL`O KANSEI HELL`O KANSEI HELL`O KANSEI HELL`O KANSEI HELL`O KANSEI HELL`O KANSEI HELL`O KANSEI HELL`O KANSEI HELL`O KANSEI HELL`O KANSEI HELL`O KANSEI HELL`O KANSEI HELL`O KANSEI HELL`O KANSEI HELL`O KANSEI HELL`O KANSEI HELL`O KANSEI', 
        fontInfo, 
        13, 
        100, 
        25);
      const sampler = new Sampler('linear', 'linear');
      const material = new Material(shaderCode, [
        {
          binding: 0,
          visibility: GPUShaderStage.VERTEX | GPUShaderStage.FRAGMENT,
          value: fontInfo.sdfTexture
        },
        {
          binding: 1,
          visibility: GPUShaderStage.FRAGMENT,
          value: sampler
        }
      ], true);
      const mesh = new Mesh(geometry, material);
      mesh.position.x = -6;
      mesh.position.y = 10;
      scene.add(mesh);

      function animate() {
        cameraControls.update();
        renderer.render(scene, camera);
        requestAnimationFrame(animate);
      }
      animate();
    </script>
  </body>
</html>